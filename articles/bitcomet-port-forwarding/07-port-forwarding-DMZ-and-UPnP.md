# 1.6 端口转发 DMZ 以及 UPnP 的作用和原理 

2023.08.15  

在上一节中遗留了一个问题没有解决  

>也不是，只要解决NAT不知道对应关系这个问题就行  
>之后的教程会讲解 告诉NAT对应关系的方法  

即告诉NAT从外部发起的连接去到哪一个内网的设备上  
以便在NAT后的设备接受来自外网的主动连接  

**问：** 那要如何操作呢？  

**答：** 可以通过 端口转发、UPnP、和DMZ 来实现  
一般家用路由器都拥有这些功能  
我们先从端口转发开始讲解  

**端口转发 （Port Forwarding）**  
可以将一个端口上的数据转发到另一个端口上  
**即将公网端口上的接收的数据转发到内网某一台设备的的端口上**  

端口转发以规则的形式存在  
**有以下的几个重要的参数**  

* 「外部端口」外网访问时使用的端口
* 「IP地址」局域网内设备的IP地址
* 「内部端口」内网设备上程序监听的端口
* 「协议」允许通过的协议

有了这样的规则后当外网设备访问指定端口时
NAT会根据规则将其转发到对应的内网设备上

**问：** 端口转发只能转发一个端口吗？  

**答：** 不止一个端口，可以通过多条规则转发多个端口  

**问：** 好像还有什么 **端口映射** 和 **虚拟服务器**  这两个有又是什么？  

**答：** 端口转发 端口映射 和 虚拟服务器 其实是指的一个东西  
虚拟服务器 这种叫法一般在tplink路由器上比较常见  

**问：** UPnP是什么？  

**答：UPnP 即 通用即插即用（Universal Plug and Play）**

它相当于自动的端口转发  
不需要手动填写规则 自动生成规则  

但要求程序和路由器都要支持UPnP功能  
在操作系统上 也需要启动对应服务  

**问：** DMZ 又是什么？  

**答：** DMZ 是“Demilitarized Zone”的缩写 也叫“非军事区”  
也可以认为是 “不设防区” **相当于将所有端口映射到一个内网地址上**  
**这样一来指定的内网设备就相当于直接暴露在公网上**  

**特点总结：**  

**端口转发**  
* 便捷性：低 需要手动填写的内容较多
* 稳定性：高 对程序无要求 静态规则除非人设置否则不会改变
* 安全性：高 纯手动设置

**UPnP**  
* 便捷性：高 启用UPnP后一般无需额外配置
* 稳定性：低 对路由器、程序、和操作系统都有要求 容易出现一些奇怪的问题
* 安全性：中 软件动自动设置 一般在路由器上可以查看已创建的规则

**DMZ**  
* 便捷性：高 仅需填写内网设备的IP地址
* 稳定性：高 对程序无要求 静态规则除非人设置否则不会改变
* 安全性：低 转发了全部的端口 相当于内网设备直接暴露在公网上 需要在终端设备上设置防火墙以保证安全


